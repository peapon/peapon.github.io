<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">




    <meta name="keywords" content="需求管理,产品经理,黑苹果">



    <meta name="description" content>


<meta name="Robots" content="all">


    <title>Req Man</title>


<link rel="icon" href="/images/favicon.ico">
<link rel="stylesheet" href="/css/font-awesome.min.css">
<link rel="stylesheet" href="/css/atom-one-dark.css">
<link rel="stylesheet" href="/css/style.css">
<script src="/js/highlight.min.js"></script>
</head>
<body>
    <div class="main-container">
        <header class="header">
    <div class="global-width">
        <nav class="nav-box">
            
                <a class="nav-item" href="/">首页</a>
            
                <a class="nav-item" href="/resume">简历</a>
            
                <a class="nav-item" href="/mood" target="_blank">心情</a>
            
                <a class="nav-item" href="/amusement/tetris" target="_blank">娱乐</a>
            
                <a class="nav-item" href="/about">不榖</a>
            
        </nav>
    </div>
</header>

        <section class="content global-width">
            <div class="main">
                
    
        <article class="box post post-item">
            <div class="post-title"><a href="/2019/04/20/在macOS-Mojave上搭建树莓派的Qt开发环境/">在macOS Mojave上搭建树莓派的Qt开发环境</a></div>
            <div class="post-meta">
                
                <i class="fa fa-calendar"></i> <time>2019-04-20</time>
                <span class="dotted">|</span>
                <i class="fa fa-user"></i> 
            </div>

            <div class="post-excerpt">
                <a href="/2019/04/20/在macOS-Mojave上搭建树莓派的Qt开发环境/">
                    <p>
                        
                            做这件事的原因有两个：第一是，接上一篇《为树莓派3B+编译Qt 5.11.2》中的Ubuntu 18.10是在虚拟机中搭建的，所以每次要进行开发时，都需要再启动一个虚拟机，有点麻烦，不想这样做，也就是懒；第二是，Mac是Unix-like系统，理论上只要找到合适的编译器，也就可以在Mac上配置环境而使用在虚拟机中编译的Qt。所以带着勇闯雷区的勇气就开始了我的尝试之旅了。
树莓派部分树莓派部分我们已经在Ubuntu中做好了一切准备，所以我们不需要再做什么了，具体参考为树莓派3B+编译Qt 5.11.2。
主机准备我的电脑的信息如下：
工作目录和工具链准备这部分的工作呢，和在Ubuntu上准备是一样的，具体如下：
123mkdir ~/raspicd ~/raspigit clone https://github.com/raspberrypi/tools
虽然我们不用tool下的gcc编译器，但我不确定是否用到其他环境，所以我们还是完整的下载。
准备正确的工具链和sysroot下载Mac下用的工具链armv8-rpi3-linux-gnueabihf-gcc-8.1.0-macos-high-sierra这个工具链是在mac下可以使用来编译Qt的交叉编译器,先git clone下这个工具链。
1git clone git@github.com:yc2986/armv8-rpi3-linux-gnueabihf-gcc-8.1.0-macos-high-sierra.git
下载完工具链后，把armv8-rpi3-linux-gnueabihf拷贝到~/raspi/tools目录下。
准备sysroot还是需要在raspi下创建sysroot，并同步树莓派上面的库
12345mkdir sysroot sysroot/usr sysroot/optrsync -avz -e &quot;ssh -p 22&quot; pi@raspberrypi.local:/lib sysrootrsync -avz -e &quot;ssh -p 22&quot; pi@raspberrypi.local:/usr/include sysroot/usrrsync -avz -e &quot;ssh -p 22&quot; pi@raspberrypi.local:/usr/lib sysroot/usrrsync -avz -e &quot;ssh -p 22&quot; pi@raspberrypi.local:/opt/vc sysroot/opt
把raspberrypi.local换成树莓派的IP。还有一种办法就是直接同步Ubuntu 下配置好的sysroot，具体方法如下：
1rsync -avz -e &quot;ssh -p 22&quot; penn@Penn 92.168.3.113:/home/penn/raspi/sysroot ./
这条命令是把Ubuntu端的sysroot同步到Mac的raspi目录。
还有一步非常非常重要的步骤，不然编译器的环境不完整，需要将~/raspi/tools/armv8-rpi3-linux-gnueabihf/armv8-rpi3-linux-gnueabihf/sysroot下所有的目录及文件拷到~/raspi/sysroot下，选择合并处理。
编译Qmake下载源代码
123wget http://download.qt.io/official_releases/qt/5.11/5.11.2/single/qt-everywhere-src-5.11.2.tar.xztar xvf  qt-everywhere-src-5.11.2.tar.xzcd  qt-everywhere-src-5.11.2
做完前面的工作，mac端的编译环境就准备好了，我们需要用到qt的编译器qmake，这个需要我们自己编译出来，步骤不重复叙述，configure要说一下。
1./configure -release -no-opengl -device linux-rasp-pi3-g++ -device-option CROSS_COMPILE=~/raspi/tools/armv8-rpi3-linux-gnueabihf/bin/armv8-rpi3-linux-gnueabihf- -sysroot ~/raspi/sysroot/ -opensource -confirm-license -skip qtwayland -skip qtlocation -skip qtscript -make libs -prefix /usr/local/qt5pi -extprefix ~/raspi/qt5pi -hostprefix ~/raspi/qt5 -no-use-gold-linker -v -no-gbm
这里注意，我们用了-no-opengl选项，因为我们在Ubuntu上已经编译了，而且这里我们也只是需要生成一个qmake及相关环境，我们并不用mac下编译出来的库。
12make -j4make install
做完上面的步骤后，执行下面的命令确认是否正确编译了qmake
12cd ~/rasp/qt5./bin/qmake -v
如果正确编译了qmake，能够得到下面的信息
QMake version 3.1
配置开发环境QtCreator的配置是跟Ubuntu下是一样的，参考为树莓派3B-编译Qt-5-11-2/#搭建开发环境
GDB要特别说明一下，这里的GDB有点区别，GDB设置的路径为
1/usr/local/Cellar/gdb/8.2.1/bin/gdb
测试环境是否可用创建一个Qt Widgets Application名字为WidgetsDemo，然后编译执行，在VNC到树莓派，可以看到我们的程序已经上传到输煤派了。
好了，到这里在macOS mojave下搭建Qt的交叉编译环境也就完成了，希望你也能成功。

                        
                    </p>
                </a>
            </div>

            
                <div class="post-footer">
                    
                    
                        <i class="fa fa-tags"></i>
                        <a class="tag-link" href="/tags/Rasp/">Rasp</a>
                    
                </div>
            
        </article>
    

    
        <article class="box post post-item">
            <div class="post-title"><a href="/2019/04/17/为树莓派3B-编译Qt-5-11-2/">为树莓派3B+编译Qt 5.11.2</a></div>
            <div class="post-meta">
                
                <i class="fa fa-calendar"></i> <time>2019-04-17</time>
                <span class="dotted">|</span>
                <i class="fa fa-user"></i> 
            </div>

            <div class="post-excerpt">
                <a href="/2019/04/17/为树莓派3B-编译Qt-5-11-2/">
                    <p>
                        
                            概述信息最近因为一个项目的原因，接触树莓派，觉得有意思，买了一个板子来自己玩，同时最近在了解QT开发，所以，就趁此机会尝试编写可以在树莓派上运行的程序。
环境准备树莓派我选择了树莓派3B+，这块板子的性能更高，因此可玩性可能更好一些，购买可以选择去马云家，搜索下有很多，具体的配置如下：
交叉编译主机Mac： 本来准备在Mac上交叉编译，并搭建相关开发环境，在参考qt-rpi-macos的指导编译后，在Mac上编译的程序没有EGL，配置起来很复杂，所以选择放弃。Ubuntu 18.04： 后来又跟着Cross-compile and deploy Qt 5.12 for Raspberry Pi这篇指导进行Qt编译和开发环境搭建，Cross-compile and deploy Qt 5.12 for Raspberry Pi的指导是在OpenSUSE 上进行的，我对Ubuntu比较熟悉，所以我选择了Ubuntu。
Qt版本Cross-compile and deploy Qt 5.12 for Raspberry Pi的中使用了Qt 5.12.0版本，但我在编译的过程中，使用Qt 5.12.0编译有问题，所以选择了5.11.2。
总结一下环境：

 树莓派3B+
 Ubuntu 18.04
 Qt 5.11.2

编译Qt树莓派端的工作树莓派基础环境准备第一步是安装树莓派，这个教程度娘家一堆，这里不重复，自行百度。
第二步是更新树莓派，以保证有最新的库，这步很重要，必须这样做，否则没有最新的库和包含文件，是没办法进行后边的操作的。
12sudo rpi-updatereboot
同时，在树莓派上配置打开VNC和SSH，可以选择用树莓派的图形界面或者是使用
1sudo raspi-config
为树莓派安装开发库为了编译Qt，我们需要安装一些必须的库文件，因为需要安装一些源文件包，因此，需要将 deb-src 的这个源启用，具体的启用方法是修改 /etc/apt/sources.list 。
1sudo nano /etc/apt/sources.list
效果如下图，要把 deb-src前面的 “#”去掉，保存后执行以下命令。
1234sudo apt-get updatesudo apt-get build-dep qt4-x11sudo apt-get build-dep libqt5gui5sudo apt-get install libudev-dev libinput-dev libts-dev libxcb-xinerama0-dev libxcb-xinerama0
上面这端代码是为树莓派安装必要的库，后边编译需要用到。
在树莓派创建QT编译后的目标文件夹在树莓派端创建如下文件夹和修改相应的权限，现在只是创建文件夹，还什么都不需要做。
12sudo mkdir /usr/local/qt5pisudo chown pi:pi /usr/local/qt5pi
主机端的工作准备工作目录和工具链要创建一个文件夹，可下载一个工具链，如果提示git没有安装，用sudo apt-get install git安装一下就可以。123mkdir ~/raspicd ~/raspigit clone https://github.com/raspberrypi/tools
创建和配置sysroot这个sysroot文件夹非常重要，我们要用这个文件夹把编译QT，以及后期开发所需的库同步过来，先在主机创建下面的文件夹
1mkdir sysroot sysroot/usr sysroot/opt
然后我们需要同步树莓派中的库文件和包含文件，我们使用rsync命令
1234rsync -avz pi@raspberrypi_ip:/lib sysrootrsync -avz pi@raspberrypi_ip:/usr/include sysroot/usrrsync -avz pi@raspberrypi_ip:/usr/lib sysroot/usrrsync -avz pi@raspberrypi_ip:/opt/vc sysroot/opt
raspberrypi_ip是你的树莓派的IP地址。同步完的效果是这样的：
接下来，调整一下符号链接，因为目录下的文件是从树莓派同步过来的，链接部分都是失效的，需要重新链接
123wget https://raw.githubusercontent.com/riscv/riscv-poky/master/scripts/sysroot-relativelinks.pychmod +x sysroot-relativelinks.py./sysroot-relativelinks.py sysroot
下载Qt在我参考的指南中，作者使用的是5.12.0版本的QT，我尝试过，并没有成功。所以我尝试换了一个版本5.11.2就成功了，所以我推荐你参考我的指南来走
123wget http://download.qt.io/official_releases/qt/5.11/5.11.2/single/qt-everywhere-src-5.11.2.tar.xztar xvf  qt-everywhere-src-5.11.2.tar.xzcd  qt-everywhere-src-5.11.2
到这里，编译前的准备工作都已经做完了了，接下来就是进入到编译的过程了。
为Qt交叉编译进行配置因为在Raspbian stretch版本中，使用了EGL，不过呢，使用了一个别的名字brcmEGL，具体方法如下：编辑./qtbase/mkspecs/devices/linux-rasp-pi3-g++/qmake.conf中的-lEGL修改为-lbrcmEGL，以及修改-lGLESv2为-lbrcmGLESv2，保存之后，使用下面的命令进行配置。
1./configure -release -opengl es2 -device linux-rasp-pi3-g++ -device-option CROSS_COMPILE=~/raspi/tools/arm-bcm2708/gcc-linaro-arm-linux-gnueabihf-raspbian-x64/bin/arm-linux-gnueabihf- -sysroot ~/raspi/sysroot -opensource -confirm-license -skip qtwayland -skip qtlocation -skip qtscript -make libs -prefix /usr/local/qt5pi -extprefix ~/raspi/qt5pi -hostprefix ~/raspi/qt5 -no-use-gold-linker -v -no-gbm
编译和安装QtConfigure运行完，如果你看到下面的提示，则表示环境配置没有任何问题，可以进行编译和安装了。
Qt is now configured for building. Just run ‘make’.Once everything is built, you must run ‘make install’.Qt will be installed into ‘/home/penn/raspi/qt5pi’.
Prior to reconfiguration, make sure you remove any leftovers fromthe previous build.
编译和安装需要多久是根据你电脑的性能的，我是用下面的命令来编译的，大概编译了2~3个小时。
12make -j4make install
make install后，实际上qt是安装在本地的qt5pi目录的，需要将这个目录上传到树莓派，还是使用rsync命令
1rsync -avz qt5pi pi@raspberrypi_ip:/usr/local
如果你顺利执行到了这一步，表示你的Qt已经编译安装成功，接下来可以进行开发环境的搭建了。
搭建开发环境开发环境创建和配置其实就两件事情，第一是连上你的树莓派，第二是配置之前编译出来的Qt的环境来编译程序
创建远程设备在QtCreator的 工具-&gt;选项 下选中 设备，添加一个新的通用Linux设备进行配置，具体见下图在设备的域名或者IP地址中填入树莓派的IP，用户名为pi，密码填写树莓派的密码。注意： 这个是用ssh进行远程访问的，要确保树莓派的ssh是打开的。
配置完成应该能够看到如下的画面：
配置编译器和Qt版本为了让我们开发的程序能够在树莓派上运行，我们需要使用适合树莓派的交叉编译器，在QtCreator中，我们要用到编译Qt的编译器，具体方法如下：在QtCreator的 工具-&gt;选项 下选中 构建和运行
添加gcc编译器，编译器的路径为1~/raspi/tools/arm-bcm2708/gcc-linaro-arm-linux-gnueabihf-raspbian-x64/bin/arm-linux-gnueabihf-gcc
添加一个G++编译器，编译器路径为1~/raspi/tools/arm-bcm2708/gcc-linaro-arm-linux-gnueabihf-raspbian-x64/bin/arm-linux-gnueabihf-g++
设置GDB切换到 Debuggers添加Debugger，这里要注意，我使用~/raspi/tools/arm-bcm2708/gcc-linaro-arm-linux-gnueabihf-raspbian-x64/bin/arm-linux-gnueabihf-gdb时，会报错，无法使用，因此我使用了gdb-multiarch。
1sudo apt-get install gdb-multiarch
之后再Debuggers中添加一个gdb-multiarch，路径为
1/usr/bin/gdb-multiarch
设置qmake切换到QtVersions页面，添加一个新的Qt版本，选择刚编译出来的qmake即可，路径为
1~/raspi/qt5/bin/qmake
设置kit在 构建套件(Kits)页面，添加一个新的Kit，设置如图上的那些信息，在完成这一步后，QtCreator的编译环境也设置好了，可以开始编程了。
开始开发在QtCreator中创建一个Qt Widgets Application程序来测试我们的环境到底有没有设置好。
设置上传路径我使用的QtCreator版本（4.5.2）创建出来的项目.pro文件，只有默认的部署路径/opt/，pi用户在树莓派上没有这个目录的写入权限，所以我们要改目录，在.pro文件中加入如下代码
1target.path = /home/pi/$$&#123;TARGET&#125;/bin!isEmpty(target.path): INSTALLS += target
然后编译执行，出现下面的信息，表示程序上传成功Starting /home/pi/WidgetTest/bin/WidgetTest…
Unable to query physical screen size, defaulting to 100 dpi.To override, set QT_QPA_EGLFS_PHYSICAL_WIDTH and QT_QPA_EGLFS_PHYSICAL_HEIGHT (in millimeters).
用VNC登录到树莓派，可以看到我们的程序是上传成功的，运行也可以看到Qt的图形界面。
链接库文件有时我们的程序需要用到树莓派使用的一些库文件比如wiringPi，在我们需要的使用，在.pro文件中加入如下的代码就可以了
1LIBS += -L/usr/lib -lwiringPi
到这一步呢，表示我们已经成功的搭建了树莓派在Ubuntu 18.10中的QtCreator的Qt开发环境了，可以进行图形界面的开发了。

                        
                    </p>
                </a>
            </div>

            
                <div class="post-footer">
                    
                    
                        <i class="fa fa-tags"></i>
                        <a class="tag-link" href="/tags/Rasp/">Rasp</a>
                    
                </div>
            
        </article>
    



            </div>
            <div class="aside">
    
        <div class="box widget">
    <div class="introduction">
        <p><img src="/images/avatar.jpg" alt="head-sculpture"></p>
        <p class="name">
            博落回
        </p>
        <p class="slogan">流连矣 忘景幻云催 峦栈醺醺说旧梦 重山迟迟映霞辉 向晚共邀归 —— 忆江南</p>
    </div>
</div>
    
        
<div class="box widget">
    <div class="title">最新</div>
    <ul class="item-box">
        
            
                <li><a href="/2020/04/19/多层物料关联/">多层物料关联递归关联处理</a></li>
            
        
            
                <li><a href="/2020/04/12/Axure-幻灯片轮播实现-简略版/">Axure 幻灯片轮播实现--简略版</a></li>
            
        
            
                <li><a href="/2019/05/29/浅谈用户思维/">浅谈用户思维</a></li>
            
        
            
                <li><a href="/2019/05/27/7Edit-安装和使用/">7Edit 安装和使用</a></li>
            
        
            
                <li><a href="/2019/05/26/为什么要创建EMR-信息化-MedCon/">为什么要创建EMR 信息化(MedCon)</a></li>
            
        
            
                <li><a href="/2019/05/11/读《情商管理课——优秀的人如何掌控情绪》/">读《情商管理课——优秀的人如何掌控情绪》</a></li>
            
        
            
                <li><a href="/2019/05/02/一个假产品经理对产品经理的理解/">一个假产品经理对产品经理的理解</a></li>
            
        
            
                <li><a href="/2019/04/21/MWeb外部模式的图片文件夹处理/">MWeb外部模式的图片文件夹处理</a></li>
            
        
    </ul>
</div>

    
        
    
        
  <div class="box widget">
    <div class="title">归档</div>
    <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">2020-04</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">2019-05</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">2019-04</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">2019-03</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">2018-07</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">2018-02</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">2018-01</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">2017-12</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">2017-11</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">2017-10</a><span class="archive-list-count">11</span></li></ul>
  </div>

    
        
    <div class="box widget">
        <div class="title">标签</div>
        <div class="item-box cloud-label">
            <a href="/tags/IT-技术/" style="font-size: 17.5px;">IT 技术</a> <a href="/tags/Python/" style="font-size: 10px;">Python</a> <a href="/tags/Rasp/" style="font-size: 12.5px;">Rasp</a> <a href="/tags/医疗信息化/" style="font-size: 10px;">医疗信息化</a> <a href="/tags/帮助/" style="font-size: 10px;">帮助</a> <a href="/tags/杂谈/" style="font-size: 10px;">杂谈</a> <a href="/tags/自我管理/" style="font-size: 15px;">自我管理</a> <a href="/tags/需求管理/" style="font-size: 20px;">需求管理</a>
        </div>
    </div>

    
</div>
        </section>
        <footer class="footer">
    <div class="global-width footer-box">
        <div class="copyright">
            <span>Copyright &copy; 2019</span>
            <span class="dotted">|</span>
            <span>Powered by <a href="https://hexo.io/">Hexo</a></span>
            <span class="dotted">|</span>
            <span>Theme by <a href="javascript:">Loren</a></span>
            <span class="dotted">|</span>
            <span><a href="http://www.beian.miit.gov.cn">浙ICP备18016660号-1</a></span>
        </div>
    </div>
</footer>
    </div>

<script>
    hljs.initHighlightingOnLoad();
</script>
</body>
</html>